<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>–î–∏–∑–∞–π–Ω —Å—Ç—É–¥–∏—è ‚Äî –ü–∞–Ω–µ–ª—å</title>
<style>
:root{--bg:#0d0f12;--card:#14171c;--muted:rgba(255,255,255,0.65);--accent:#4c6ef5}
*{box-sizing:border-box}
body{margin:0;font-family:Inter,Segoe UI,system-ui,Arial;background:linear-gradient(180deg,#0b0c0e 0%, #0d0f12 100%);color:#fff}
.topbar{height:64px;background:var(--card);display:flex;align-items:center;justify-content:space-between;padding:0 20px;border-bottom:1px solid rgba(255,255,255,0.04)}
.nav a{color:var(--muted);margin-right:18px;text-decoration:none;font-weight:600}
.container{padding:22px;max-width:1100px;margin:28px auto}
.grid{display:grid;grid-template-columns:1fr 340px;gap:20px}
.card{background:rgba(20,23,28,0.9);padding:16px;border-radius:12px;border:1px solid rgba(255,255,255,0.03)}
h2{margin:0 0 12px 0}
label{display:block;font-size:13px;color:var(--muted);margin-top:8px}
input,select{width:100%;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:#0f1316;color:#fff;margin-top:6px}
button{background:var(--accent);border:none;color:#fff;padding:8px 12px;border-radius:8px;cursor:pointer}
.muted{color:var(--muted);font-size:13px}
table{width:100%;border-collapse:collapse;margin-top:12px}
th,td{padding:10px;border-bottom:1px dashed rgba(255,255,255,0.03);text-align:left}
.status-pill{display:inline-block;padding:6px 8px;border-radius:999px;font-weight:700;font-size:13px}
.controls{display:flex;gap:8px}
.small{padding:6px 8px;font-size:13px}
.right{display:flex;gap:8px;align-items:center}
.status-list{max-height:300px;overflow:auto;margin-top:8px}
.status-row{display:flex;justify-content:space-between;align-items:center;padding:8px;border-radius:8px;background:rgba(255,255,255,0.01);margin-bottom:8px}
.link-like{background:none;border:none;color:var(--muted);cursor:pointer}
.topbar .right{align-items:center}
.logo{font-weight:800;letter-spacing:0.4px}
.empty{opacity:.6;padding:20px;border-radius:8px;text-align:center}
/* modal */
.modal{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0.55)}
.modal .card{width:640px}
.hidden{display:none}
@media(max-width:900px){.grid{grid-template-columns:1fr}}
</style>
</head>
<body>

<!-- LOGIN -->
<div id="loginBox" class="container">
  <div class="card" style="max-width:420px;margin:60px auto;padding:28px;text-align:center">
    <div class="logo">DesignStudio</div>
    <h2 style="margin-top:8px">–í—Ö–æ–¥ —á–µ—Ä–µ–∑ Google</h2>
    <button id="googleLogin" style="margin-top:20px;width:100%;">–í–æ–π—Ç–∏ —á–µ—Ä–µ–∑ Google</button>
  </div>
</div>

<!-- APP -->
<div id="app" class="hidden">
  <div class="topbar">
    <div style="display:flex;align-items:center;gap:18px">
      <div class="logo">DesignStudio</div>
      <nav class="nav">
        <a href="#" onclick="openTab('projects')">–ü—Ä–æ–µ–∫—Ç—ã</a>
        <a href="#" onclick="openTab('tasks')">–ó–∞–¥–∞—á–∏</a>
        <a href="#" onclick="openTab('finance')">–§–∏–Ω–∞–Ω—Å—ã</a>
        <a href="#" onclick="openTab('analytics')">–ê–Ω–∞–ª–∏—Ç–∏–∫–∞</a>
      </nav>
    </div>
    <div class="right">
      <div class="muted" id="userLabel"></div>
      <button onclick="logout()" class="small">–í—ã–π—Ç–∏</button>
    </div>
  </div>

  <div class="container">
    <div class="grid">
      <div>
        <div id="projects" class="card tab">
          <h2>–ü—Ä–æ–µ–∫—Ç—ã</h2>
          <div style="display:flex;gap:8px;flex-wrap:wrap;margin-bottom:8px">
            <input id="qSearch" placeholder="–ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é" style="flex:1">
            <select id="filterStatus" style="width:180px">
              <option value="all">–í—Å–µ —Å—Ç–∞—Ç—É—Å—ã</option>
            </select>
            <button id="addProjectBtn">–ù–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç</button>
          </div>
          <table id="projTable" aria-describedby="projDesc">
            <caption id="projDesc" class="muted">–°–ø–∏—Å–æ–∫ –ø—Ä–æ–µ–∫—Ç–æ–≤</caption>
            <thead>
              <tr><th>–ü—Ä–æ–µ–∫—Ç</th><th>–°—Ç–∞—Ç—É—Å</th><th>–î–µ–¥–ª–∞–π–Ω</th><th>–ë—é–¥–∂–µ—Ç</th><th></th></tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
        <div id="tasks" class="card tab hidden"><h2>–ó–∞–¥–∞—á–∏</h2><div class="muted">–ü—É—Å—Ç–æ</div></div>
        <div id="finance" class="card tab hidden"><h2>–§–∏–Ω–∞–Ω—Å—ã</h2><div class="muted">–ü—É—Å—Ç–æ</div></div>
        <div id="analytics" class="card tab hidden"><h2>–ê–Ω–∞–ª–∏—Ç–∏–∫–∞</h2><div class="muted">–ü—É—Å—Ç–æ</div></div>
      </div>

      <div>
        <div class="card" id="status-management">
          <h3>–°—Ç–∞—Ç—É—Å—ã –∑–∞–∫–∞–∑–æ–≤</h3>
          <div class="muted">–î–æ–±–∞–≤–ª—è–π, —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π –∏ —É–¥–∞–ª—è–π —Å—Ç–∞—Ç—É—Å—ã (—Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω).</div>
          <div style="display:flex;gap:8px;margin-top:10px">
            <input id="newStatusText" placeholder="–≠–º–æ–¥–∑–∏ –∏ –Ω–∞–∑–≤–∞–Ω–∏–µ">
            <button id="addStatusBtn">–î–æ–±–∞–≤–∏—Ç—å</button>
          </div>
          <div class="status-list" id="statusList"></div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modal -->
<div id="modal" class="modal hidden">
  <div class="card">
    <h3 id="modalTitle">–ù–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç</h3>
    <label>–ù–∞–∑–≤–∞–Ω–∏–µ</label>
    <input id="mName">
    <label>–°—Ç–∞—Ç—É—Å</label>
    <select id="mStatus"></select>
    <label>–î–µ–¥–ª–∞–π–Ω</label>
    <input id="mDate" type="date">
    <label>–ë—é–¥–∂–µ—Ç (‚ÇΩ)</label>
    <input id="mBudget" type="number" min="0">
    <div style="display:flex;gap:8px;margin-top:12px;justify-content:flex-end">
      <button id="saveModalBtn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
      <button class="link-like" onclick="closeModal()">–û—Ç–º–µ–Ω–∞</button>
    </div>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-app.js";
import { getFirestore } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-firestore.js";
import { getAuth, GoogleAuthProvider, signInWithPopup, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-auth.js";

const firebaseConfig = {
  apiKey: "AIzaSyC4X8TIIegH0En1tuUspJtixyc-dcx1_9Y",
  authDomain: "studia-35b43.firebaseapp.com",
  projectId: "studia-35b43",
  storageBucket: "studia-35b43.firebasestorage.app",
  messagingSenderId: "186158637676",
  appId: "1:186158637676:web:e62c3261a06441e4fb2e49",
  measurementId: "G-L339B7CMZK"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const provider = new GoogleAuthProvider();

const ADMIN_EMAIL = "batytvoeymamas@gmail.com";
window.canEdit = false;

const DB_KEY='ds_data_v1';
function loadDB(){const raw=localStorage.getItem(DB_KEY);if(!raw) return {statuses:["‚è≥ –†–∞–±–æ—Ç–∞","‚úÖ –ì–æ—Ç–æ–≤","üí∞ –û–ø–ª–∞—Ç–∞"],projects:[]}; try{return JSON.parse(raw);}catch(e){return {statuses:["‚è≥ –†–∞–±–æ—Ç–∞","‚úÖ –ì–æ—Ç–æ–≤","üí∞ –û–ø–ª–∞—Ç–∞"],projects:[]}}}
function saveDB(db){localStorage.setItem(DB_KEY,JSON.stringify(db));}
let DB = loadDB();

// --- Google Login ---
document.getElementById('googleLogin').onclick = async () => {
  try {
    const result = await signInWithPopup(auth, provider);
    const user = result.user;
    window.canEdit = (user.email === ADMIN_EMAIL);
    initApp(user.displayName || user.email + (window.canEdit ? ' (Admin)' : ''));
  } catch(err) {
    alert('–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞: '+err.message);
  }
}

// --- Auth State ---
onAuthStateChanged(auth, user => {
  if(user){
    window.canEdit = (user.email === ADMIN_EMAIL);
    initApp(user.displayName || user.email + (window.canEdit ? ' (Admin)' : ''));
  }
});

// --- Logout ---
function logout(){window.canEdit=false;signOut(auth);location.reload();}

// --- App ---
function initApp(userLabel){
  document.getElementById('loginBox').classList.add('hidden');
  document.getElementById('app').classList.remove('hidden');
  document.getElementById('userLabel').innerText = userLabel;

  renderStatuses();
  renderProjects();
  populateFilter();

  document.getElementById('addProjectBtn').onclick = ()=>{if(window.canEdit) openAddModal();};
  document.getElementById('addStatusBtn').onclick = ()=>{if(window.canEdit) addStatus();};
  document.getElementById('qSearch').addEventListener('input',renderProjects);
  document.getElementById('filterStatus').addEventListener('change',renderProjects);
}

// --- Tabs ---
function openTab(id){document.querySelectorAll('.tab').forEach(t=>t.classList.add('hidden'));document.getElementById(id).classList.remove('hidden');}

// --- Status ---
function renderStatuses(){
  const container=document.getElementById('statusList');container.innerHTML='';
  DB.statuses.forEach((s,i)=>{
    const row=document.createElement('div');row.className='status-row';
    row.innerHTML=`<div>${s}</div>
      <div class="controls" style="display:${window.canEdit?'flex':'none'}">
        <button class="link-like" onclick="editStatus(${i})">‚úèÔ∏è</button>
        <button class="link-like" onclick="removeStatus(${i})">üóëÔ∏è</button>
      </div>`;
    container.appendChild(row);
  });
  saveDB(DB);
  populateStatusSelects();
}
function addStatus(){const v=document.getElementById('newStatusText').value.trim();if(!v){alert('–í–≤–µ–¥–∏—Ç–µ —Å—Ç–∞—Ç—É—Å');return;}DB.statuses.push(v);document.getElementById('newStatusText').value='';renderStatuses();}
function editStatus(i){const val=prompt('–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å—Ç–∞—Ç—É—Å',DB.statuses[i]);if(val!=null){DB.statuses[i]=val.trim()?val:DB.statuses[i];renderStatuses();}}
function removeStatus(i){if(!confirm('–£–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ç—É—Å?')) return;DB.statuses.splice(i,1);renderStatuses();}
function populateStatusSelects(){const selects=[document.getElementById('mStatus'),document.getElementById('filterStatus')];selects.forEach(sel=>{const cur=sel.value;sel.innerHTML='';if(sel.id==='filterStatus') sel.appendChild(new Option('–í—Å–µ —Å—Ç–∞—Ç—É—Å—ã','all'));DB.statuses.forEach(s=>sel.appendChild(new Option(s,s)));if(cur) sel.value=cur;});

// --- Projects ---
function renderProjects(){
  const tbody=document.querySelector('#projTable tbody');tbody.innerHTML='';
  const q=document.getElementById('qSearch').value.toLowerCase();
  const filter=document.getElementById('filterStatus').value;
  const list=DB.projects.filter(p=> (p.name.toLowerCase().includes(q)) && (filter==='all'||p.status===filter));
  if(list.length===0){tbody.innerHTML=`<tr><td colspan="5" class="empty">–ù–µ—Ç –ø—Ä–æ–µ–∫—Ç–æ–≤</td></tr>`;return}
  list.forEach((p,idx)=>{
    const tr=document.createElement('tr');
    tr.innerHTML=`<td>${p.name}</td>
      <td><span class="status-pill">${p.status}</span></td>
      <td>${p.date||'‚Äî'}</td>
      <td>${p.budget||'‚Äî'} ‚ÇΩ</td>
      <td><div class="controls" style="display:${window.canEdit?'flex':'none'}">
        <button class="small" onclick="openEditModal(${idx})">‚úèÔ∏è</button>
        <button class="small" onclick="deleteProject(${idx})">üóëÔ∏è</button>
      </div></td>`;
    tbody.appendChild(tr);
  });
}

let editIndex=null;
function openAddModal(){editIndex=null;document.getElementById('modalTitle').innerText='–ù–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç';document.getElementById('mName').value='';document.getElementById('mDate').value='';document.getElementById('mBudget').value='';populateStatusSelects();document.getElementById('modal').classList.remove('hidden');}
function openEditModal(i){editIndex=i;const p=DB.projects[i];document.getElementById('modalTitle').innerText='–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–µ–∫—Ç';document.getElementById('mName').value=p.name;document.getElementById('mStatus').value=p.status;document.getElementById('mDate').value=p.date||'';document.getElementById('mBudget').value=p.budget;populateStatusSelects();document.getElementById('modal').classList.remove('hidden');}
function closeModal(){document.getElementById('modal').classList.add('hidden');}
document.getElementById('saveModalBtn').onclick=function(){
  if(!window.canEdit) return;
  const name=document.getElementById('mName').value.trim();
  const status=document.getElementById('mStatus').value;
  const date=document.getElementById('mDate').value;
  const budget=document.getElementById('mBudget').value;
  if(!name){alert('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ');return;}
  const obj={name,status,date,budget};
  if(editIndex===null) DB.projects.push(obj); else DB.projects[editIndex]=obj;
  saveDB(DB);renderProjects();closeModal();
}
function deleteProject(i){if(!window.canEdit) return; if(!confirm('–£–¥–∞–ª–∏—Ç—å –ø—Ä–æ–µ–∫—Ç?')) return;DB.projects.splice(i,1);saveDB(DB);renderProjects();}
function populateFilter(){const f=document.getElementById('filterStatus');const cur=f.value;f.innerHTML='';f.appendChild(new Option('–í—Å–µ —Å—Ç–∞—Ç—É—Å—ã','all'));DB.statuses.forEach(s=>f.appendChild(new Option(s,s)));if(cur) f.value=cur;}
</script>
</body>
</html>
