<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–û—Å–Ω–æ–≤–∞ | MixerCheck</title>
  <link rel="stylesheet" href="css/main.css">
  <style>
    body {
      font-family: 'Segoe UI', system-ui, sans-serif;
      background: #0a0a0a;
      color: #fff;
      margin: 0;
      display: flex;
    }
    .sidebar {
      width: 240px;
      background: #111;
      border-right: 1px solid #1a1a1a;
      height: 100vh;
      position: fixed;
      left: 0;
      top: 0;
      display: flex;
      flex-direction: column;
    }
    .profile-header { padding: 20px; border-bottom: 1px solid #1a1a1a; }
    .profile-avatar {
      width: 36px; height: 36px;
      background: #ff6b00; border-radius: 8px;
      display: flex; align-items: center; justify-content: center;
      color: #000; font-weight: 700;
    }
    .logout-btn {
      background: #1a1a1a; border: 1px solid #222; color: #ccc;
      padding: 6px 10px; border-radius: 6px; cursor: pointer;
      font-size: 12px; margin-left: auto;
    }
    .logout-btn:hover { background: #222; color: #fff; }
    .menu-section { padding: 16px 0; }
    .section-title {
      color: #555; font-size: 11px; text-transform: uppercase;
      padding: 0 20px 8px 20px;
    }
    .menu-items { list-style: none; margin: 0; padding: 0; }
    .menu-item a {
      display: flex; align-items: center;
      padding: 10px 20px; text-decoration: none; color: #999;
      transition: 0.2s;
    }
    .menu-item a:hover { color: #fff; background: #1a1a1a; }
    .menu-item a.active { color: #ff6b00; background: #1a1a1a; }
    .main-content { margin-left: 240px; padding: 30px; }
  </style>
</head>
<body>
  <aside class="sidebar">
    <div class="profile-header">
      <div style="display:flex; align-items:center; gap:10px;">
        <div class="profile-avatar" id="avatar">U</div>
        <div>
          <div id="usernameDisplay">User</div>
          <div style="font-size:12px; color:#777;">beta</div>
        </div>
        <button class="logout-btn" id="logoutBtn">–í—ã–π—Ç–∏</button>
      </div>
    </div>

    <div class="menu-navigation">
      <div class="menu-section">
        <div class="section-title">–ü—Ä–æ–≥—Ä–∞–º–º—ã</div>
        <ul class="menu-items">
          <li class="menu-item"><a href="everything.html"><span class="menu-icon">üîé</span>Everything</a></li>
          <li class="menu-item"><a href="Sy.html"><span class="menu-icon">‚öôÔ∏è</span>SystemInformer</a></li>
          <li class="menu-item"><a href="PS.html"><span class="menu-icon">üíª</span>PowerShell</a></li>
          <li class="menu-item" id="adminLink"><a href="admin.html"><span class="menu-icon">üõ†</span>–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</a></li>
        </ul>
      </div>
    </div>
  </aside>

  <div class="main-content">
    <h1>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ MixerCheck</h1>
    <p>–≠—Ç–æ –≤–∞—à–∞ –æ—Å–Ω–æ–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞.</p>
  </div>

  <script type="module">
  import { db } from "./firebase.js";
  import { collection, query, where, getDocs } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

  async function initPage() {
    const username = localStorage.getItem("username");
    if (!username) return (window.location.href = "index.html");

    try {
      const q = query(collection(db, "users"), where("username", "==", username));
      const snap = await getDocs(q);

      if (snap.empty) {
        alert("‚õî –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω!");
        localStorage.removeItem("username");
        return (window.location.href = "index.html");
      }

      const user = snap.docs[0].data();
      document.getElementById("usernameDisplay").textContent = username;
      document.getElementById("avatar").textContent = username[0].toUpperCase();

      // –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞
      const pages = ["everything.html", "Sy.html", "PS.html"];
      for (const p of pages) {
        const li = document.querySelector(`a[href="${p}"]`)?.closest("li");
        if (li) li.style.display = user.access.includes(p) ? "block" : "none";
      }

      const adminLi = document.getElementById("adminLink");
      adminLi.style.display = user.role === "admin" ? "block" : "none";

    } catch (err) {
      console.error(err);
      alert("–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–æ—Å—Ç—É–ø–∞");
      window.location.href = "index.html";
    }

    document.getElementById("logoutBtn").addEventListener("click", () => {
      localStorage.removeItem("username");
      window.location.href = "index.html";
    });
  }

  initPage();
  </script>
</body>
</html>
