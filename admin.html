<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Админ-панель | MixerCheck</title>
  <link rel="stylesheet" href="css/main.css">
  <style>
    body {
      font-family: 'Segoe UI', system-ui, sans-serif;
      background: #0a0a0a;
      color: #fff;
      margin: 0;
      padding: 20px;
    }
    .user-list {
      margin-top: 20px;
      border: 1px solid #222;
      border-radius: 8px;
      padding: 10px;
    }
    button {
      background: #ff6b00;
      border: none;
      padding: 6px 12px;
      border-radius: 4px;
      cursor: pointer;
      color: #000;
      font-weight: 600;
    }
  </style>
</head>
<body>
  <h1>Админ-панель</h1>
  <div id="userList" class="user-list">Загрузка...</div>

  <script type="module">
  import { db } from "./firebase.js";
  import { collection, getDocs, updateDoc, doc } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

  async function initAdmin() {
    const username = localStorage.getItem("username");
    if (!username) return (window.location.href = "index.html");

    const usersSnap = await getDocs(collection(db, "users"));
    const currentUser = [...usersSnap.docs].find(d => d.data().username === username);

    if (!currentUser || currentUser.data().role !== "admin") {
      alert("⛔ Только для администраторов!");
      return (window.location.href = "osnova.html");
    }

    const list = document.getElementById("userList");
    list.innerHTML = "";

    usersSnap.forEach(docSnap => {
      const user = docSnap.data();
      const div = document.createElement("div");
      div.innerHTML = `
        <b>${user.username}</b> — роль: ${user.role || "user"}<br>
        Доступ: ${user.access?.join(", ") || "нет"}<br>
        <button data-id="${docSnap.id}">Удалить доступ</button>
        <hr>`;
      list.appendChild(div);

      div.querySelector("button").addEventListener("click", async () => {
        await updateDoc(doc(db, "users", docSnap.id), { access: [] });
        alert("Доступ сброшен!");
        initAdmin();
      });
    });
  }

  initAdmin();
  </script>
</body>
</html>
